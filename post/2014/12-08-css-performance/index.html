<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>[译]css性能 - Cirplan</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=author content="cirplan"><meta name=description content="css性能"><meta name=keywords content="css,performance"><link rel=canonical href=https://cirplan.me/post/2014/12-08-css-performance/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link href=/sass/main.min.4325dd250c3d3e29d579a819f16fd876adbc5a03b3a1b32d2eefe0a067e8f219.css rel=stylesheet><meta property="og:title" content="[译]css性能"><meta property="og:description" content="css性能"><meta property="og:type" content="article"><meta property="og:url" content="https://cirplan.me/post/2014/12-08-css-performance/"><meta property="article:section" content="post"><meta property="article:published_time" content="2014-12-08T21:32:59+08:00"><meta property="article:modified_time" content="2014-12-08T21:32:59+08:00"><meta itemprop=name content="[译]css性能"><meta itemprop=description content="css性能"><meta itemprop=datePublished content="2014-12-08T21:32:59+08:00"><meta itemprop=dateModified content="2014-12-08T21:32:59+08:00"><meta itemprop=wordCount content="1382"><meta itemprop=keywords content="css,performance,"><meta name=twitter:card content="summary"><meta name=twitter:title content="[译]css性能"><meta name=twitter:description content="css性能"></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>Cirplan</a></div><div class=mobile-navbar-icon id=mobile-navbar-icon><span></span>
<span></span>
<span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/><li class=mobile-menu-item>主页</li></a><a href=/post/><li class=mobile-menu-item>归档</li></a><a href=/tags/><li class=mobile-menu-item>标签</li></a><a href=/categories/><li class=mobile-menu-item>分类</li></a><a href=/about/><li class=mobile-menu-item>关于</li></a><a href=https://github.com/cirplan><li class=mobile-menu-item>Github</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=/ class=logo>Cirplan</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/>主页</a></li><li class=menu-item><a class=menu-item-link href=/post/>归档</a></li><li class=menu-item><a class=menu-item-link href=/tags/>标签</a></li><li class=menu-item><a class=menu-item-link href=/categories/>分类</a></li><li class=menu-item><a class=menu-item-link href=/about/>关于</a></li><li class=menu-item><a class=menu-item-link href=https://github.com/cirplan>Github</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>[译]css性能</h1><div class=post-meta><span class=post-time>2014-12-08</span><div class=post-category><a href=/categories/css/>css</a></div><span class=more-meta>约 1382 字</span>
<span class=more-meta>预计阅读 3 分钟</span></div></header><div class=post-outdated><div class=warn><p>【注意】最后更新于 <span class=timeago datetime=2014-12-08T21:32:59 title=2014-12-08>2014-12-08, </span>，文中内容可能已过时，请谨慎使用。</p></div></div><div class=post-content><p>原文：<a href=https://dl.dropboxusercontent.com/u/39519/talks/cssperf/index.html>CSS Performance</a>（2011年文章，有着很赞的翻转效果，前提是祭出高级浏览器）</p><p><strong>目录</strong></p><ol><li>Reflows（重排）</li><li>Hardware Accelerated Css（硬件加速css）</li><li>Avoiding Expensive Css（避免高消耗css）</li><li>Selector Perf（选择器性能）</li><li>Style Matching Perf（样式匹配性能）</li><li>Polyfills</li><li>Debugging（调试）</li></ol><h2 id=1-重排><strong>1. 重排</strong></h2><p>先来看看html页面的渲染、绘制流程图</p><p><img src=/post/2014/images/1208/render.png alt=render></p><ol><li>根据<code>Html</code>标签生成<code>Dom</code>树（<code>Dom tree</code>）；根据默认的，用户自定义的样式生成样式结构（<code>Styles struct</code>）</li><li>生成渲染树（<code>Render tree</code>）</li><li>绘制页面</li></ol><p>下面是重排的渲染短视频：</p><video controls preload autobuffer width=860 height=510>
<source src=https://dl.dropboxusercontent.com/u/39519/talks/cssperf/assets/geckoreflow-mozillaorg.mp4 type=video/mp4><source src=https://dl.dropboxusercontent.com/u/39519/talks/cssperf/assets/geckoreflow-mozillaorg.webm type=video/webm></video><p>下面，先看看重绘机制：如何（不）触发<code>WebKit</code>的布局（<a href=http://gent.ilcore.com/2011/03/how-not-to-trigger-layout-in-webkit.html>How (not) to trigger a layout in WebKit</a>）（2011）。</p><p>简单译文：</p><p>许多<code>Web</code>开发者意识到，一段<code>js</code>脚本在运行的时候，是在触发<code>DOM</code>的操作而不是执行代码本身。这样一个潜在消耗时间，从<code>Dom</code>树构建渲染树（<code>Render tree</code>）的过程，被称作布局（又称重排）。约庞大越复杂的<code>Dom</code>树，就会消耗更多的时间。</p><p>一个很重要的方法让页面的不假死，就是让分开的Dom操作放在一起。</p><p>ex:</p><pre><code>// 一般，触发两次布局
var newWidth = aDiv.offsetWidth + 10; // Read
aDiv.style.width = newWidth + 'px'; // Write
var newHeight = aDiv.offsetHeight + 10; // Read
aDiv.style.height = newHeight + 'px'; // Write

// 更好, 只触发一次布局
var newWidth = aDiv.offsetWidth + 10; // Read
var newHeight = aDiv.offsetHeight + 10; // Read
aDiv.style.width = newWidth + 'px'; // Write
aDiv.style.height = newHeight + 'px'; // Write
</code></pre><p>然后这里就会有个问题：什么情况会触发布局？下面是整理的一些元素和方法：</p><pre><code>Element
clientHeight, clientLeft, clientTop, clientWidth, focus(), getBoundingClientRect(), getClientRects(), innerText, offsetHeight, offsetLeft, offsetParent, offsetTop, offsetWidth, outerText, scrollByLines(), scrollByPages(), scrollHeight, scrollIntoView(), scrollIntoViewIfNeeded(), scrollLeft, scrollTop, scrollWidth

Frame, Image
height, width

Range
getBoundingClientRect(), getClientRects()

SVGLocatable
computeCTM(), getBBox()

SVGTextContent
getCharNumAtPosition(), getComputedTextLength(), getEndPositionOfChar(), getExtentOfChar(), getNumberOfChars(), getRotationOfChar(), getStartPositionOfChar(), getSubStringLength(), selectSubString()

SVGUse
instanceRoot

window
getComputedStyle(), scrollBy(), scrollTo(), scrollX, scrollY, webkitConvertPointFromNodeToPage(), webkitConvertPointFromPageToNode()
</code></pre><p>当然列出的这些不是全部，这只是一个很好的开始。最好的方法是通过Chrome或者Firefox浏览器的调试器去查看。（翻译完）</p><p>好的，再回到这里，我们看看什么动作会触发重排。</p><ul><li>增加，删除，更新<code>Dom</code>节点。</li><li>通过<code>display:none</code>隐藏元素。</li><li>对页面上的<code>Dom</code>元素进行移动等动画。</li><li>增加样式，或调整样式属性。</li><li>用户改变窗口大小，改变字体大小，或者滚动页面。</li></ul><h3 id=策略>策略：</h3><ul><li>在触发重排动作前，对<code>Dom</code>进行批量操作。</li><li>复制节点的属性，在复制的节点里进行操作，在一次交换过来。</li><li>先用<code>display:none</code>隐藏节点，再进行大量的操作，再通过<code>display</code>显示。</li></ul><p>更多重排文章：</p><p><a href=http://www.phpied.com/rendering-repaint-reflowrelayout-restyle/>Stoyan Stefanov on Reflow/Repaint</a></p><p><a href=http://calendar.perfplanet.com/2009/the-new-game-show-will-it-reflow/>The new game show: &ldquo;Will it reflow?&rdquo;</a></p><p><a href="http://www.browserscope.org/?category=reflow">Mozilla&rsquo;s David Baron on Browser Internals for Web Developers</a></p><p><a href="https://www.youtube.com/watch?v=a2_6bGNZ7bA">WebKit blog five-part series on rendering</a></p><h2 id=2硬件加速css><strong>2.硬件加速css</strong>##</h2><p>充分利用<code>Css</code>的<code>transitions</code>和<code>transforms</code>达到最优的质量。
这方面主要应用于手机，ios和Android</p><video controls preload autobuffer width=860 height=310>
<source src=https://dl.dropboxusercontent.com/u/39519/talks/cssperf/assets/translate3d.mp4 type=video/mp4><source src=https://dl.dropboxusercontent.com/u/39519/talks/cssperf/assets/translate3d.webm type=video/webm></video><h2 id=3避免高消耗css><strong>3.避免高消耗css</strong>##</h2><ul><li>@font-face</li><li>box-shadow</li><li>opacity compositing</li><li>gradients</li><li>text-align</li></ul><p>(这部分待续&mldr;)</p><h2 id=4选择器性能><strong>4.选择器性能</strong>##</h2><p>浏览器默认是从右到左。</p><p>下面选择器引擎是从左到右：</p><ul><li>Mootools</li><li>Sly</li><li>Peppy</li><li>Dojo Acme</li><li>Ext JS</li><li>Prototype.js</li></ul><p>下面是从右到左：</p><ul><li>Sizzle</li><li>YUI 3</li><li>NWMatcher</li><li>querySelectorAll</li></ul><p>选择器优化</p><p>推荐组合是：<code>tag .class</code>，让标签在左边，尽可能让class在右边。</p><h2 id=5样式匹配性能><strong>5.样式匹配性能</strong>##</h2><p>关于样式匹配，请看<a href=http://screwlewse.com/2010/08/different-css-techniques-and-their-performance/>样式匹配性能</a>。</p><h2 id=6polyfills><strong>6.Polyfills</strong>##</h2><p>关于Polyfills的介绍：</p><blockquote><p>Polyfilling 是由 RemySharp 提出的一个术语，它是用来描述复制缺少的 API 和API 功能的行为。你可以使用它编写单独应用的代码而不用担心其他浏览器原生是不是支持。实际上，polyfills并不是新技术也不是和 HTML5 捆绑到一起的。我们已经在如json2.js，ie7-js 和为 IE 浏览器提供透明 PNG支持的JS中使用过了。而和现在 polyfills 的区别就是去年增加的 HTML5 polyfills。</p></blockquote><p>相关信息：</p><ul><li><a href=http://selectivizr.com/>Selectivizr</a></li><li><a href=http://css3pie.com/>CSS3Pie</a></li><li><a href=https://github.com/Modernizr/Modernizr/wiki/HTML5-Cross-Browser-Polyfills>Modernizr wiki list of polyfills</a></li></ul><h2 id=7调试><strong>7.调试</strong>##</h2><p>主要是手机硬件方面的调试。
相关信息：</p><ul><li><a href=http://peter.sh/experiments/chromium-command-line-switches/>All of Chrome&rsquo;s command line switches</a></li><li><a href=http://mir.aculo.us/2011/02/08/visualizing-webkits-hardware-acceleration/>Thomas Fuchs: Safari and iPhone Simulator CoreAnimation debugging info.</a></li><li><a href=http://www.html5rocks.com/en/tutorials/speed/html5/>HTML5Rocks: Improving the Performance of your HTML5 App</a></li></ul></div><div class=post-copyright><p class=copyright-item><span class=item-title>文章作者</span>
<span class=item-content>cirplan</span></p><p class=copyright-item><span class=item-title>上次更新</span>
<span class=item-content>2014-12-08</span></p><p class=copyright-item><span class=item-title>文章链接</span>
<span class=item-content>https://cirplan.me/post/2014/12-08-css-performance/</span></p><p class=copyright-item><span class=item-title>许可协议</span>
<span class=item-content><a rel="license noopener" href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh target=_blank>署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0)</a></span></p></div><footer class=post-footer><div class=post-tags><a href=/tags/css/>css</a>
<a href=/tags/performance/>performance</a></div><nav class=post-nav><a class=prev href=/post/2014/12-08-css-selector/><i class="iconfont icon-left"></i>
<span class="prev-text nav-default">[译]css选择器渲染优化</span>
<span class="prev-text nav-mobile">上一篇</span></a>
<a class=next href=/post/2014/12-05-css-specificity-wars/><span class="next-text nav-default">[译]层叠和选择器的明确度--权重</span>
<span class="next-text nav-mobile">下一篇</span>
<i class="iconfont icon-right"></i></a></nav></footer></article></div></div></main><footer id=footer class=footer><div class=copyright><span class=copyright-year>&copy;
2013 -
2022<span class=heart>🥕</span><span>cirplan</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script>window.onload=function(){const e="fixed-open",n="slideout-open",s="icon-click",t=document.querySelector("#mobile-navbar-icon");t.addEventListener("click",o=>{const i=document.querySelector("#mobile-navbar"),a=document.querySelector("#mobile-panel");i.classList.contains(e)?(i.classList.remove(e),a.classList.remove(e),t.classList.remove(s),document.documentElement.classList.remove(n)):(i.classList.add(e),a.classList.add(e),t.classList.add(s),document.documentElement.classList.add(n))})}</script></body></html>