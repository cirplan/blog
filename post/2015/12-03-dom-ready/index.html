<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>DOM ready原理 - Cirplan</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=author content="cirplan"><meta name=description content="DOM ready原理"><meta name=keywords content="dom"><link rel=canonical href=https://cirplan.github.io/post/2015/12-03-dom-ready/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link href=/sass/main.min.4325dd250c3d3e29d579a819f16fd876adbc5a03b3a1b32d2eefe0a067e8f219.css rel=stylesheet><meta property="og:title" content="DOM ready原理"><meta property="og:description" content="DOM ready原理"><meta property="og:type" content="article"><meta property="og:url" content="https://cirplan.github.io/post/2015/12-03-dom-ready/"><meta property="article:section" content="post"><meta property="article:published_time" content="2015-12-03T22:00:24+08:00"><meta property="article:modified_time" content="2015-12-03T22:00:24+08:00"><meta itemprop=name content="DOM ready原理"><meta itemprop=description content="DOM ready原理"><meta itemprop=datePublished content="2015-12-03T22:00:24+08:00"><meta itemprop=dateModified content="2015-12-03T22:00:24+08:00"><meta itemprop=wordCount content="1080"><meta itemprop=keywords content="dom,html,"><meta name=twitter:card content="summary"><meta name=twitter:title content="DOM ready原理"><meta name=twitter:description content="DOM ready原理"></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>Cirplan</a></div><div class=mobile-navbar-icon id=mobile-navbar-icon><span></span>
<span></span>
<span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/><li class=mobile-menu-item>主页</li></a><a href=/post/><li class=mobile-menu-item>归档</li></a><a href=/tags/><li class=mobile-menu-item>标签</li></a><a href=/categories/><li class=mobile-menu-item>分类</li></a><a href=https://github.com/cirplan><li class=mobile-menu-item>Github</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=/ class=logo>Cirplan</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/>主页</a></li><li class=menu-item><a class=menu-item-link href=/post/>归档</a></li><li class=menu-item><a class=menu-item-link href=/tags/>标签</a></li><li class=menu-item><a class=menu-item-link href=/categories/>分类</a></li><li class=menu-item><a class=menu-item-link href=https://github.com/cirplan>Github</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>DOM ready原理</h1><div class=post-meta><span class=post-time>2015-12-03</span><div class=post-category><a href=/categories/html/>html</a></div><span class=more-meta>约 1080 字</span>
<span class=more-meta>预计阅读 3 分钟</span></div></header><div class=post-outdated><div class=warn><p>【注意】最后更新于 <span class=timeago datetime=2015-12-03T22:00:24 title=2015-12-03>2015-12-03, </span>，文中内容可能已过时，请谨慎使用。</p></div></div><div class=post-content><p><code>DOM ready</code>这个已经有很多人说了，说的也很详细，这里简单说下。利用问题的形式展开～</p><p><strong>问：为什么需要<code>dom ready</code>?</strong></p><p>答：我们需要在页面加载后，再进行一些js操作，例如：绑定事件，操作DOM。</p><p><strong>问：为什么不用<code>window.onload</code>事件？</strong></p><p>答：<code>window.onload</code>要等页面内的所有资源都加载完才触发，像图片、音频等，等待的时间会比较长。</p><p><strong>问：那直接用<code>DOMContentLoaded</code>就好，还墨迹这么多？</strong></p><p>答：<code>DOMContentLoaded</code>本来是<code>FireFox</code>的私有事件，FF3版本才完整支持，<code>webkit</code>系列的在525版本后才增加这个事件的支持，IE系列的在IE9才开始支持。
可以看看它的兼容性，如下：</p><p><img src=/post/2015/images/1203dom/compatibility.png alt></p><p><strong>问：IE在不支持<code>DOMContentLoaded</code>事件的情况下，如何判断<code>DOM ready</code>？</strong></p><ul><li><p>方法一：往页面内添加<code>script</code>标签，添加<code>defer</code>属性，通过监听这个脚本的<code>readyState</code>，当脚本加载完成时就判断<code>DOM ready</code>了。</p><p>但这个方法的缺点是：当页面里有<code>iframe</code>的时候，会等<code>iframe</code>里所有的资源加载完才触发，和<code>onload</code>差不多。</p></li><li><p>方法二：通过轮询来调用<code>document.documentElement.doScroll</code>方法，调用成功表示<code>DOM ready</code>了。</p></li></ul><p>所以，IE下用方法二来判断<code>DOM ready</code>。</p><p><strong>问：<code>document.documentElement.doScroll</code>是个什么鬼？</strong></p><p>答：IE下一些事件只有在DOM准备好后才能触发，<code>document.documentElement.doScroll</code>就是这样一个事件。通过判断调用是否成功，进而判断DOM是否加载完。
这个hack最早是外国的大牛发现的，详情可以看<a href=http://javascript.nwbox.com/IEContentLoaded/>这里</a>。</p><p><strong>问：IE的判断完了，那<code>webkit</code>系列的在525版本之前的怎么判断？</strong></p><p>答：通过轮询判断<code>document.readyState</code>，当<code>readyState</code>为<code>loaded/complete</code>的时候，判断DOM加载完毕。</p><p><strong>问：你说的我都懂，有没有什么现成的库？</strong></p><p>答：基本上比较流行的库都有实现的，像<code>jQuery/Zepto/Prototype/Moontools/YUI</code>等，只是每个库实现的方式都不同。</p><p><code>github</code>上也有个比较出名的库<a href=https://github.com/ded/domready>domready</a>，现在它的主分支是针对有<code>DOMContentLoaded</code>事件的浏览器，兼容性如下：</p><ul><li>IE9+</li><li>Firefox 4+</li><li>Safari 3+</li><li>Chrome *</li><li>Opera *</li></ul><p>不过它的<a href=https://github.com/ded/domready/releases/tag/v0.3.0>0.3.0</a>分支是兼容多种浏览器的，兼容性如下：</p><ul><li>IE6+</li><li>Firefox 2+</li><li>Safari 3+</li><li>Chrome *</li><li>Opera *</li></ul><h3 id=最后>最后</h3><p>如果是用在移动端的话，可以放心的通过<code>DOMContentLoaded</code>事件来判断。PC的话，国内现在的环境，还是乖乖用兼容版本吧。</p><p>参考：</p><ul><li><a href=http://www.cnblogs.com/JulyZhang/archive/2011/02/12/1952484.html>http://www.cnblogs.com/JulyZhang/archive/2011/02/12/1952484.html</a></li></ul></div><footer class=post-footer><div class=post-tags><a href=/tags/dom/>dom</a>
<a href=/tags/html/>html</a></div><nav class=post-nav><a class=prev href=/post/2016/01-22-promise-study-1/><i class="iconfont icon-left"></i>
<span class="prev-text nav-default">Promise初级教程1：简单使用</span>
<span class="prev-text nav-mobile">上一篇</span></a>
<a class=next href=/post/2015/11-30-html5-audio/><span class="next-text nav-default">Audio在移动端的实践</span>
<span class="next-text nav-mobile">下一篇</span>
<i class="iconfont icon-right"></i></a></nav></footer></article></div></div></main><footer id=footer class=footer><div class=copyright><span class=copyright-year>&copy;
2013 -
2022<span class=heart>🥕</span><span>cirplan</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script>window.onload=function(){const e="fixed-open",n="slideout-open",s="icon-click",t=document.querySelector("#mobile-navbar-icon");t.addEventListener("click",o=>{const i=document.querySelector("#mobile-navbar"),a=document.querySelector("#mobile-panel");i.classList.contains(e)?(i.classList.remove(e),a.classList.remove(e),t.classList.remove(s),document.documentElement.classList.remove(n)):(i.classList.add(e),a.classList.add(e),t.classList.add(s),document.documentElement.classList.add(n))})}</script></body></html>